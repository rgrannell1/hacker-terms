
"use strict"




var analyseData         = require('hacker-terms/stats/analyse-data')
var findTermFrequency   = require('hacker-terms/stats/find-term-frequency')
var averageUsageInRange = require('hacker-terms/stats/average-usage-in-range')





var printUsage = usages => {

	var str = ''

	// -- refactor this crap.
	usages.forEach(usage => {

		Object.keys(usage.termAverages).forEach(term => {
			str += `\ntermAverages.${term}    ${usage.termAverages[term]}`
		})

		str += `\ntimeLabel    ${usage.timeLabel}`
		str += `\nobservations    ${usage.observations}`
		str += '\n'

	})

	process.stdout.write(str + '\n')

}





var main = rawArgs => {

	var args = main.validate(main.preprocess(rawArgs))

	if (args.freq) {

		analyseData(args, data => {

			findTermFrequency(args, data, freqs => {

				printUsage(averageUsageInRange(args, freqs))
				process.exit(0)

			})

		})

	}

}

main.validate = rawArgs => {
	return rawArgs
}

main.preprocess = rawArgs => {

	return {
		freq:    rawArgs.freq,
		phrases: rawArgs['<phrase>'],
		year:    rawArgs['-y'] || rawArgs['--year'],
		month:   rawArgs['-m'] || rawArgs['--month']
	}

}





module.exports = main
